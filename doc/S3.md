# S3 Storage Engine Configuration

pgmoneta supports Amazon Web Services (AWS) S3 and S3-compatible storage services as remote storage for backups.

## Amazon Web Services (AWS)

pgmoneta supports AWS S3 object storage service with path-style URLs.

```ini
storage_engine = s3

# Your access credentials
s3_access_key_id = <access_key_id>
s3_secret_access_key = <secret_access_key>

# Storage location
s3_bucket = <bucket_name>
s3_base_dir = <base_directory>

# AWS region (default: us-east-1)
s3_region = <region>

# Storage class for cost optimization (optional)
s3_storage_class = <storage_class>

# Custom port (default: 443 for TLS, 80 for non-TLS)
s3_port = <port>

# Enable or disable TLS for S3 (default: off, but enabled for port 443)
s3_use_tls = <on|off>
```

### Example

```ini
[pgmoneta]
storage_engine = s3
s3_access_key_id = <access_key_id>
s3_secret_access_key = <secret_access_key>
s3_bucket = <bucket_name>
s3_base_dir = <base_directory>
s3_region = <region>
s3_storage_class = <storage_class>
```

**Available AWS Storage Classes:**
- `STANDARD` - Default, frequent access
- `INTELLIGENT_TIERING` - Automatic cost optimization
- `STANDARD_IA` - Infrequent access
- `ONEZONE_IA` - Single AZ, infrequent access
- `GLACIER_INSTANT_RETRIEVAL` - Archive with instant retrieval
- `GLACIER_FLEXIBLE_RETRIEVAL` - Archive with flexible retrieval
- `GLACIER_DEEP_ARCHIVE` - Lowest cost archive
- `REDUCED_REDUNDANCY` - Legacy, not recommended

## S3-Compatible Storage (Garage)

pgmoneta supports self-hosted S3-compatible storage services like [Garage](https://garagehq.deuxfleurs.fr/) using path-style URLs.

```ini
storage_engine = s3

# Your access credentials
s3_access_key_id = <access_key_id>
s3_secret_access_key = <secret_access_key>

# Storage location
s3_bucket = <bucket_name>
s3_base_dir = <base_directory>

# Custom endpoint configuration
s3_endpoint = <endpoint_url>
s3_port = <port>
s3_region = <region>

# Enable or disable TLS for S3 (default: off, but enabled for port 443)
s3_use_tls = <on|off>
```

**Note:** When using `s3_endpoint`, the bucket name is included in the request path (path-style URLs). The `s3_storage_class` parameter is not supported with custom endpoints.

### Example

```ini
[pgmoneta]
storage_engine = s3
s3_access_key_id = <access_key_id>
s3_secret_access_key = <secret_access_key>
s3_bucket = <bucket_name>
s3_base_dir = <base_directory>
s3_endpoint = <endpoint_url>
s3_port = <port>
s3_region = <region>
```
